<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Consol by richjenks</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Consol</h1>
      <h2 class="project-tagline">Micro framework for command line PHP apps</h2>
      <a href="https://github.com/richjenks/consol" class="btn">View on GitHub</a>
      <a href="https://github.com/richjenks/consol/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/richjenks/consol/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="consol--micro-framework-for-command-line-php-apps" class="anchor" href="#consol--micro-framework-for-command-line-php-apps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Consol — Micro framework for command line PHP apps</h1>

<p>Consol is a minimal and unopinionated micro framework for developing simple yet powerful command line apps and services that is easy to read and write, requires minimal prerequisite knowledge, has no dependencies and prefers common-case over edge-case solutions.</p>

<h2>
<a id="hello-world" class="anchor" href="#hello-world" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hello, World!</h2>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// app.php</span></span>
<span class="pl-s1"><span class="pl-smi">$app</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RichJenks\Consol\</span><span class="pl-c1">App</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>map(<span class="pl-s"><span class="pl-pds">'</span>hello<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>Hello World<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">});</span>
<span class="pl-s1"></span></pre></div>

<div class="highlight highlight-source-shell"><pre><span class="pl-c"># terminal</span>
php app.php hello
<span class="pl-c"># Hello World</span></pre></div>

<h2>
<a id="key-features" class="anchor" href="#key-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Key Features</h2>

<ul>
<li>Routes terminal requests</li>
<li>Simplifies parameters and options</li>
<li>Generates command directory</li>
<li>Packages your app as a PHAR</li>
</ul>

<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li>PHP &gt;=5.5</li>
<li>Phar PHP extension</li>
<li>
<code>phar.readonly = 0</code> in <code>/etc/php5/cli/php.ini</code>
</li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Install via <a href="https://getcomposer.org/">Composer</a> with <code>composer require richjenks/consol</code> or download and include it in your code with <code>require 'consol/App.php';</code></p>

<h2>
<a id="mapping-commands-to-code" class="anchor" href="#mapping-commands-to-code" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mapping Commands to Code</h2>

<p>A Consol app could look like this:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">#!/usr/local/bin/php</span></span>
<span class="pl-s1"><span class="pl-k">&lt;</span>?<span class="pl-c1">php</span> <span class="pl-k">require</span> <span class="pl-s"><span class="pl-pds">'</span>vendor/autoload.php<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>map(<span class="pl-s"><span class="pl-pds">'</span>hello<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$app</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>Hello World<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">}, <span class="pl-s"><span class="pl-pds">'</span>Say "Hello" to the World<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>run();</span></pre></div>

<p>Calling <code>php app.php hello</code> from the command line will run this command. The <code>map</code> function accepts 3 parameters:</p>

<ol>
<li>Command to trigger the route</li>
<li>Callback to map to the command</li>
<li>Optional description of the command</li>
</ol>

<blockquote>
<p>Commands can only contain alphanumerics, colons, hyphens and underscores.</p>
</blockquote>

<h2>
<a id="magic-commands" class="anchor" href="#magic-commands" aria-hidden="true"><span class="octicon octicon-link"></span></a>Magic Commands</h2>

<p>Magic Commands are commands that are not included in the command map and are called by special events. There are 2 Magic Commands and they are:</p>

<ol>
<li>Colon (<code>:</code>) which represents when no command is issued (the root command)</li>
<li>Question Mark (<code>?</code>) which represents an unknown command</li>
</ol>

<p>Here's an example of overriding the default unknown command handler:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>map(<span class="pl-s"><span class="pl-pds">'</span>?<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$app</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>say(<span class="pl-s"><span class="pl-pds">'</span>I have no idea what I<span class="pl-cce">\'</span>m doing...<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">});</span></pre></div>

<p>Both have default handlers which are overridden by mapping them to your own code. By default, the root command will show the Command Directory (which has its own section below) and unknown commands will display the text "Unknown Command" in red and may attempt to suggest an intended function in case of a typo via the <code>suggest()</code> function,  which is documented further down.</p>

<h2>
<a id="using-app" class="anchor" href="#using-app" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using <code>$app</code>
</h2>

<p>The <code>$app</code> object is made available to your commands and it exposes a number of useful functions:</p>

<h3>
<a id="say" class="anchor" href="#say" aria-hidden="true"><span class="octicon octicon-link"></span></a>Say</h3>

<p>Outputs text to the console and should be used instead of <code>echo</code>, <code>print</code>, etc. because it outputs immediately (rather than at the end of the script) and allows responses to be edited by Middleware (which has its own section below). It accepts 2 parameters:</p>

<ol>
<li>The text to be output</li>
<li>An optional color for the text</li>
</ol>

<p>Available colors are <code>aqua</code>, <code>black</code>, <code>blue</code>, <code>cyan</code>, <code>emerald</code>, <code>gray</code>, <code>lilac</code>, <code>green</code>, <code>maroon</code>, <code>navy</code>, <code>orange</code>, <code>purple</code>, <code>red</code>, <code>silver</code>, <code>white</code> and <code>yellow</code>.</p>

<p>For example: <code>$app-&gt;say('Oh hai!', 'green');</code></p>

<h3>
<a id="color" class="anchor" href="#color" aria-hidden="true"><span class="octicon octicon-link"></span></a>Color</h3>

<p>Identical to <code>say()</code> except it returns the text rather than outputting immediately.</p>

<h3>
<a id="ask" class="anchor" href="#ask" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ask</h3>

<p>Prompt the user to provide information, for example:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$name</span> <span class="pl-k">=</span> ask(<span class="pl-s"><span class="pl-pds">'</span>What is your name: <span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">say(<span class="pl-s"><span class="pl-pds">"</span>Hello, <span class="pl-smi">$name</span>!<span class="pl-pds">"</span></span>);</span></pre></div>

<p>It has three parameters but only the first is required:</p>

<ol>
<li>The text to display to the user</li>
<li>Default value if user enters nothing (or <code>null</code> for no default value)</li>
<li>Regular Expression against which the value is checked</li>
</ol>

<blockquote>
<p>Providing <code>null</code> as the default value means that no default value will be considered — it does not mean it will return <code>null</code> if no value is provided.</p>
</blockquote>

<p>Here's a more practical example:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$name</span> <span class="pl-k">=</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>ask(<span class="pl-s"><span class="pl-pds">'</span>What is your name: <span class="pl-pds">'</span></span>, <span class="pl-c1">null</span>, <span class="pl-s"><span class="pl-pds">'</span>.+<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>say(<span class="pl-s"><span class="pl-pds">"</span>Hello, <span class="pl-smi">$name</span>!<span class="pl-pds">"</span></span>);</span></pre></div>

<p>The above example will prompt the user for their name, but if none is given then it will ask again. The answer must be at least one character. <code>ask</code> isn't very clever, so you are free to define whatever logic you like.</p>

<p>Or to ask for confirmation:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$sure</span> <span class="pl-k">=</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>ask(<span class="pl-s"><span class="pl-pds">'</span>Are you sure? [y/n] <span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>n<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y|n<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>say((<span class="pl-smi">$sure</span> <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>) ? <span class="pl-s"><span class="pl-pds">'</span>You are sure<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>You are unsure<span class="pl-pds">'</span></span>);</span></pre></div>

<p>Here are a few example regular expressions for common requirements:</p>

<ul>
<li>
<code>.*</code>  Accept anything, including empty values</li>
<li>
<code>.+</code> Accept anything, must be at least one character</li>
<li>
<code>y|n</code> Accepts anything containing "y", "n" (basic confirmation)</li>
<li>
<code>^yes$|^no$|^maybe$</code> Accepts only "yes", "no" or "maybe"</li>
</ul>

<blockquote>
<p>Neither validation rules nor default values are shown to the user — you are free to provide whatever information you wish in the first "question" parameter.</p>
</blockquote>

<h3>
<a id="progress" class="anchor" href="#progress" aria-hidden="true"><span class="octicon octicon-link"></span></a>Progress</h3>

<p>Shows a progress bar to the user and accepts two values: current progress and total. For example:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>say(<span class="pl-s"><span class="pl-pds">'</span>Progressing...<span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1"><span class="pl-smi">$progress</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"><span class="pl-k">while</span> (<span class="pl-smi">$progress</span> <span class="pl-k">&lt;=</span> <span class="pl-c1">70</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>progress(<span class="pl-smi">$progress</span>, <span class="pl-c1">70</span>);</span>
<span class="pl-s1">    <span class="pl-smi">$progress</span> <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-c1">3</span>;</span>
<span class="pl-s1">    <span class="pl-c1">sleep</span>(<span class="pl-c1">1</span>);</span>
<span class="pl-s1">}</span>
<span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>progress(<span class="pl-c1">70</span>, <span class="pl-c1">70</span>);</span>
<span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>say(<span class="pl-c1">PHP_EOL</span> <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>Progress complete<span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-c1">PHP_EOL</span>);</span></pre></div>

<h3>
<a id="table" class="anchor" href="#table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Table</h3>

<h3>
<a id="suggest" class="anchor" href="#suggest" aria-hidden="true"><span class="octicon octicon-link"></span></a>Suggest</h3>

<h3>
<a id="get-request" class="anchor" href="#get-request" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get Request</h3>

<p>This is a testing function that can be used to analyse the request. It returns an array with the keys <code>command</code>, <code>params</code>, <code>options</code> and <code>map</code>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>get_request());</span>
<span class="pl-s1"><span class="pl-c">//</span></span></pre></div>

<p>The <code>param()</code> and <code>option()</code> functions are preferred as they integrate will middleware and are generally "nicer" from a syntax perspective.</p>

<h2>
<a id="command-directory" class="anchor" href="#command-directory" aria-hidden="true"><span class="octicon octicon-link"></span></a>Command Directory</h2>

<p>When mapping commands to callbacks, the <code>$app-&gt;map()</code> function accepts an optional third argument: a description of the command. This is used to construct a directory of available commands that is shown by the default handler for the root command and it looks like this:</p>

<pre><code>Commands:
  hello   Say "Hello" to the World

</code></pre>

<p>The directory makes use of the <code>table()</code> function (documented below) to output tabular data and it can also be shown manually by returning <code>$app-&gt;directory()</code> from within a command's callback:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>map(<span class="pl-s"><span class="pl-pds">'</span>directory<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$app</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>say(<span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>directory());</span>
<span class="pl-s1">});</span></pre></div>

<h2>
<a id="parameters" class="anchor" href="#parameters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters</h2>

<p>Data can be retrieved from the command line in the form of parameters. For example, running <code>php app.php hello World</code> will return <code>Hello World</code>. <code>$app-&gt;param()</code> can be used to get the value of a parameter in a one-indexed fashion — zero contains the command, which in this case is <code>hello</code>.</p>

<p>For example, to say hello in the color of your choosing, you could register the following command:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>map(<span class="pl-s"><span class="pl-pds">'</span>hello<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$app</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>say(</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>Hello <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>param(<span class="pl-c1">1</span>),</span>
<span class="pl-s1">        <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>param(<span class="pl-c1">2</span>)</span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>

<p>and then call:</p>

<div class="highlight highlight-source-shell"><pre>php app.php hello World blue
<span class="pl-c"># Outputs "Hello World" in blue</span></pre></div>

<h2>
<a id="options" class="anchor" href="#options" aria-hidden="true"><span class="octicon octicon-link"></span></a>Options</h2>

<p>Options are similar to Parameters but are prepended by two hyphens, e.g. <code>--foo</code>, and can optionally provide values, e.g. <code>--foo=bar</code>. They can be at any position in the command line call but are ignored by the indexing of parameters. For example, if you call <code>php app.php foo --fizzbuzz bar</code> then <code>foo</code> will still be parameter one and <code>bar</code> will still be parameter two.</p>

<blockquote>
<p>No options are sacred to a Consol app — for example, there is no concept of verbosity and no options are reserved, so you are free to implement any options you like!</p>
</blockquote>

<p>The two types of options are <em>Flag</em> and <em>Value</em> options:</p>

<h3>
<a id="flags" class="anchor" href="#flags" aria-hidden="true"><span class="octicon octicon-link"></span></a>Flags</h3>

<p>Flags are <code>true</code> when present and <code>false</code> when omitted:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>map(<span class="pl-s"><span class="pl-pds">'</span>hello<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$app</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$greeting</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Hello <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>param(<span class="pl-c1">1</span>);</span>
<span class="pl-s1">    <span class="pl-k">if</span> (<span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>option(<span class="pl-s"><span class="pl-pds">'</span>yell<span class="pl-pds">'</span></span>)) <span class="pl-smi">$greeting</span> <span class="pl-k">=</span> <span class="pl-c1">strtoupper</span>(<span class="pl-smi">$greeting</span>);</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>say(<span class="pl-smi">$greeting</span>);</span>
<span class="pl-s1">});</span></pre></div>

<div class="highlight highlight-source-shell"><pre>php app.php hello World --yell
<span class="pl-c"># Outputs "HELLO WORLD"</span></pre></div>

<p>Flag options can also be passed in short form (e.g. <code>-yv</code>) and you can check for the presence of multiple flags to facilitate this, e.g. <code>if ($app-&gt;option('y', 'yell')) { ... }</code>. No link exists between short and long options so you are free to define any combination you wish by use of the <code>option()</code> function.</p>

<h3>
<a id="values" class="anchor" href="#values" aria-hidden="true"><span class="octicon octicon-link"></span></a>Values</h3>

<p>Values hold strings when present and are <code>false</code> when omitted:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>map(<span class="pl-s"><span class="pl-pds">'</span>hello<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$app</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$greeting</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Hello <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>param(<span class="pl-c1">1</span>);</span>
<span class="pl-s1">    <span class="pl-k">if</span> (<span class="pl-c1">is_string</span>(<span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>option(<span class="pl-s"><span class="pl-pds">'</span>from<span class="pl-pds">'</span></span>)))</span>
<span class="pl-s1">        <span class="pl-smi">$greeting</span> <span class="pl-k">.=</span> <span class="pl-s"><span class="pl-pds">'</span>, from <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>option(<span class="pl-s"><span class="pl-pds">'</span>from<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>say(<span class="pl-smi">$greeting</span>);</span>
<span class="pl-s1">});</span></pre></div>

<div class="highlight highlight-source-shell"><pre>php app.php hello World --from=Moon
<span class="pl-c"># Outputs "Hello World, from Moon"</span></pre></div>

<p>Note that Consol can't distinguish between a flag option and an empty value option, so <code>is_string()</code> should be used to check for the presence of a value option. Absent value options return <code>false</code> like an omitted flag option.</p>

<h2>
<a id="middleware" class="anchor" href="#middleware" aria-hidden="true"><span class="octicon octicon-link"></span></a>Middleware</h2>

<p>Middleware allows you to edit a request before it is routed through the map and the response output before it is shown to the console. Middleware in console applications is not as important as with web applications because of the proportion of things happening in the background and things visible to the user, but it is still a useful tool that allows multiple commands to be edited by the same filter(s).</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/richjenks/consol">Consol</a> is maintained by <a href="https://github.com/richjenks">richjenks</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
